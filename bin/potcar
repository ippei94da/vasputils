#! /usr/bin/env ruby
# coding: utf-8

require "thor"
#gem "vasputils"
require "vasputils"

class PotcarCommand < Thor

  desc 'generate [options] elem1 [elem2, ...]', 'generate POTCAR of elements'
  option :poscar, desc: 'Alternatively use of elements in POSCAR',
    lazy_default: "POSCAR"
  def generate(*elements)
    if options[:poscar] && (! elements.empty?)
      puts "Error. Duplicated indication of elements with argument and --poscar option."
      exit
    end

    if options[:poscar]
      elements = VaspUtils::Poscar.load_file(options[:poscar]).elements
    end

    setting = VaspUtils::Setting.new

    vpc = VaspUtils::Potcar::Concatenater.new(
      setting['potcar_dir'],
      setting['default_potcar']
    )
    vpc.dump(elements, STDOUT)
  end
end

PotcarCommand.start(ARGV)
