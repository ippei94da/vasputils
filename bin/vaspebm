#! /usr/bin/env ruby
# coding: utf-8

require "comana"
require "fileutils"
require "optparse"
require "pp"
require "rubygems"
require "vasputils"

def show_usage
  puts <<-HERE
USAGE
  vaspebm command [option] [path]

E.g.,
  vaspebm interpolate [option] contcar0 contcar1

  HERE
end
# vaspebm show  [option] [path] # Show state of vasp geometry optimization.
# vaspebm latest         [path] # Show latest vaspdir.
# vaspebm run   [option] [path] # Run vasp geometry optimization
# vaspebm next  [option] [path] # Generate next step of ebm.
# vaspebm initialize  [option] [path] # Initialize ebm.
# vaspebm reincarnate [option] [path] # Generate new ebm from final structure.

command = ARGV.shift

def vaspebm_generate(arguments)
  options = {:periodic => true}
  op = OptionParser.new
  op.banner = [
      "Usage: #{File.basename("#{__FILE__}")} generate [options]",
  ].join("\n")
  op.on("-i val"    , "--images=val"    , "number of images"){|v| options[:images] = v.to_i}
  op.on("-P"    , "--no-periodic"    , "Not periodic"){ options[:periodic] = false}
  op.parse!(arguments)

  path0 = arguments.shift
  path1 = arguments.shift
  new_dir_name = arguments.shift
  num_images = arguments.shift
  num_images ||= 1

  #pp num_images
  #pp options
  #exit
  VaspUtils::VaspElasticBand.generate(path0, path1, new_dir_name, num_images, options[:periodic])
end

case command
when "generate"
  vaspebm_generate(ARGV)
#when "interpolate"
#    VaspUtils::VaspElasticBand.interpolate(ARGV)
#when "show"
#    VaspUtils::VaspElasticBand.show_inspect(ARGV)
#when "latest"
#    VaspUtils::VaspElasticBand.show_latest(ARGV)
#when "run"
#    VaspUtils::VaspElasticBand.run(ARGV)
##when "reset"
##    VaspUtils::VaspElasticBand.reset(ARGV)
#when "next"
#    VaspUtils::VaspElasticBand.next(ARGV)
#when "initialize"
#    VaspUtils::VaspElasticBand.reset_initialize(ARGV)
#when "reincarnate"
#    VaspUtils::VaspElasticBand.reincarnate(ARGV)
#when "--help"
#    show_usage
else
  puts "Unknown command: #{command}"
  show_usage
end

